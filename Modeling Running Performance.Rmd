---
title: "Modeling Run Performance"
author: "Joe Martin"
date: "10/27/2021"
output: html_document
---
## Garmin Data Modeling

```{r echo=FALSE}
# Load packages and data
pacman::p_load(tidyverse, tidymodels, here)

garmin <- read_rds(here::here("data","processed_data", "garmin_data.rds"))

# Transform data to have only the necessary variables
df <- garmin %>% select(-aerobic_fct,-anaerobic_fct,-week)
```

The two most obvious primary target variables are average speed (avg_spd) in miles per hour, and average pace (avg_pace_sec) in seconds. A higher average speed and a lower average pace are the desired outcome when measuring performance over time. Reviewing the results of the two preliminary linear regression models, the more desirable variable is average pace, as it has stronger relationships with other variables. 
```{r}
# Create preliminary model

prelim_spd <- lm(avg_spd ~ ., df)
summary(prelim_spd)

```

```{r}
prelim_pace <- lm(avg_pace_sec ~ ., df)
summary(prelim_pace)

```

The ultimate goal of this model is to utilize data leading up to a performance event. As many races take place on Sunday and the typical long-distance run in this data set takes place on Sunday, the final linear regression model will begin with predicting Sunday performance. If Sunday data is absent, the week will be dropped. Each individual week will be added to a k-fold cross validation. 

To being predicting run performance, an initial linear regression model is built below using all available data. 

```{r}
set.seed(456)
# Split data into training and testing sets
df_split <- initial_split(df, prop = 3/4)

train_df <- training(df_split)
test_df <- testing(df_split)

# Create recipe
pace_rec <- recipe(avg_pace_sec ~ ., data = df)

summary(pace_rec)
```

```{r}
lm_pace <- linear_reg() %>%
  set_engine("lm")

pace_wflow <- workflow()%>%
  add_model(lm_pace) %>%
  add_recipe(pace_rec)

pace_fit <- pace_wflow %>% 
  fit(data = train_df)

tidy(pace_fit)
```

```{r}
predict(pace_fit, test_df)
```

```{r}
pace_aug <- augment(pace_fit, train_df)

pace_all_train <- pace_aug %>%
                    mutate(data = "train",
                            model = "all")

pace_aug
```

```{r}
n_error <- pace_aug %>% 
  yardstick::rmse(truth = avg_pace_sec, .pred)

summary(n_error)
```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```